<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>ubuntu-deployment-steps - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-FOR+APACHE+2.2+-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D">FOR APACHE 2.2 =============</a>
    <li><a href="#label-FOR+APACHE+2.4+-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D">FOR APACHE 2.4 =============</a>
    <li><a href="#label-END+APACHE+2.4+-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D">END APACHE 2.4 =============</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../Capfile.html">Capfile</a>
  
    <li><a href="../Gemfile.html">Gemfile</a>
  
    <li><a href="../Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="../Procfile.html">Procfile</a>
  
    <li><a href="../README_md.html">README</a>
  
    <li><a href="../Rakefile.html">Rakefile</a>
  
    <li><a href="../app/assets/fonts/Roboto-Black-Italic/Roboto-BlackItalic-webfont_svg.html">Roboto-BlackItalic-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Black/Roboto-Black-webfont_svg.html">Roboto-Black-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Bold-Condensed-Italic/RobotoCondensed-BoldItalic-webfont_svg.html">RobotoCondensed-BoldItalic-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Bold-Condensed/RobotoCondensed-Bold-webfont_svg.html">RobotoCondensed-Bold-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Bold-Italic/Roboto-BoldItalic-webfont_svg.html">Roboto-BoldItalic-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Bold/Roboto-Bold-webfont_svg.html">Roboto-Bold-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Condensed-Italic/RobotoCondensed-Italic-webfont_svg.html">RobotoCondensed-Italic-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Condensed/RobotoCondensed-Regular-webfont_svg.html">RobotoCondensed-Regular-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Italic/Roboto-Italic-webfont_svg.html">Roboto-Italic-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Light-Condensed-Italic/RobotoCondensed-LightItalic-webfont_svg.html">RobotoCondensed-LightItalic-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Light-Condensed/RobotoCondensed-Light-webfont_svg.html">RobotoCondensed-Light-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Light-Italic/Roboto-LightItalic-webfont_svg.html">Roboto-LightItalic-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Light/Roboto-Light-webfont_svg.html">Roboto-Light-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Medium-Italic/Roboto-MediumItalic-webfont_svg.html">Roboto-MediumItalic-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Medium/Roboto-Medium-webfont_svg.html">Roboto-Medium-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Regular/Roboto-Regular-webfont_svg.html">Roboto-Regular-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Thin-Italic/Roboto-ThinItalic-webfont_svg.html">Roboto-ThinItalic-webfont.svg</a>
  
    <li><a href="../app/assets/fonts/Roboto-Thin/Roboto-Thin-webfont_svg.html">Roboto-Thin-webfont.svg</a>
  
    <li><a href="../app/assets/javascripts/templates/breadcrumb_hbs.html">breadcrumb.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/dashboard/complexity_popover_hbs.html">complexity_popover.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/dashboard/setup_hbs.html">setup.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/dashboard/viz_hbs.html">viz.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/import/finalize_measures_hbs.html">finalize_measures.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/import/import_measure_hbs.html">import_measure.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/matrix_hbs.html">matrix.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/measure_hbs.html">measure.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/measure/complexity_hbs.html">complexity.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/measure/complexity_popover_hbs.html">complexity_popover.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/measure/coverage_hbs.html">coverage.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/measure/export_patients_hbs.html">export_patients.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/measure/fraction_hbs.html">fraction.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/measure/percentage_hbs.html">percentage.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/measure/population_hbs.html">population.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/measure/population_edit_hbs.html">population_edit.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/measure/status_hbs.html">status.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/measure/value_sets/codes_items_hbs.html">codes_items.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/measure/value_sets/codes_list_hbs.html">codes_list.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/measure/value_sets/value_sets_hbs.html">value_sets.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/measure_debug_hbs.html">measure_debug.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/measures_hbs.html">measures.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patient_bank/filters_hbs.html">filters.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patient_bank/measure_patients_hbs.html">measure_patients.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patient_bank/patient_bank_hbs.html">patient_bank.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patient_bank/selected_patients_hbs.html">selected_patients.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patient_builder/edit_codes_hbs.html">edit_codes.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patient_builder/edit_criteria_hbs.html">edit_criteria.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patient_builder/edit_fulfillments_hbs.html">edit_fulfillments.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patient_builder/edit_reference_hbs.html">edit_reference.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patient_builder/edit_value_hbs.html">edit_value.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patient_builder/expected_value_hbs.html">expected_value.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patient_builder/expected_values_hbs.html">expected_values.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patient_builder/measure_ribbon_hbs.html">measure_ribbon.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patient_builder/patient_builder_hbs.html">patient_builder.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patient_builder/select_criteria_hbs.html">select_criteria.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patient_builder/value_set_code_checker_hbs.html">value_set_code_checker.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patients/patients_hbs.html">patients.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patients/record_hbs.html">record.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patients/record_entry_hbs.html">record_entry.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patients/record_header_hbs.html">record_header.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/patients/record_section_hbs.html">record_section.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/population_calculation_hbs.html">population_calculation.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/population_calculation_results_hbs.html">population_calculation_results.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/users/edit_user_hbs.html">edit_user.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/users/email_users_hbs.html">email_users.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/users/export_bundle_hbs.html">export_bundle.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/users/table_header_hbs.html">table_header.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/users/user_hbs.html">user.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/users/user_summary_hbs.html">user_summary.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/users/users_hbs.html">users.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/value_sets_builder/value_set_hbs.html">value_set.hbs</a>
  
    <li><a href="../app/assets/javascripts/templates/value_sets_builder/value_sets_builder_hbs.html">value_sets_builder.hbs</a>
  
    <li><a href="../app/assets/stylesheets/application_css_less.html">application.css.less</a>
  
    <li><a href="../app/assets/stylesheets/bank_less.html">bank.less</a>
  
    <li><a href="../app/assets/stylesheets/bootstrap3_less.html">bootstrap3.less</a>
  
    <li><a href="../app/assets/stylesheets/builder_less.html">builder.less</a>
  
    <li><a href="../app/assets/stylesheets/dashboard_less.html">dashboard.less</a>
  
    <li><a href="../app/assets/stylesheets/errors_less.html">errors.less</a>
  
    <li><a href="../app/assets/stylesheets/landing_less.html">landing.less</a>
  
    <li><a href="../app/assets/stylesheets/matrix_less.html">matrix.less</a>
  
    <li><a href="../app/assets/stylesheets/measure_less.html">measure.less</a>
  
    <li><a href="../app/assets/stylesheets/measure_calculation_less.html">measure_calculation.less</a>
  
    <li><a href="../app/assets/stylesheets/measures_less.html">measures.less</a>
  
    <li><a href="../app/assets/stylesheets/mixins_less.html">mixins.less</a>
  
    <li><a href="../app/assets/stylesheets/rationale_less.html">rationale.less</a>
  
    <li><a href="../app/assets/stylesheets/users_less.html">users.less</a>
  
    <li><a href="../app/assets/stylesheets/value_sets_less.html">value_sets.less</a>
  
    <li><a href="../app/assets/stylesheets/variables_less.html">variables.less</a>
  
    <li><a href="../app/assets/stylesheets/vsbuilder_less.html">vsbuilder.less</a>
  
    <li><a href="../bower_json.html">bower.json</a>
  
    <li><a href="../config_ru.html">config.ru</a>
  
    <li><a href="../coverage/assets/0_10_0/application_css.html">application.css</a>
  
    <li><a href="../coverage/assets/0_10_0/application_js.html">application.js</a>
  
    <li><a href="../coverage/covered_percent.html">covered_percent</a>
  
    <li><a href="../coverage/index_html.html">index.html</a>
  
    <li><a href="../demo_script_txt.html">demo_script</a>
  
    <li><a href="../deployment/ec2-deployment-steps_txt.html">ec2-deployment-steps</a>
  
    <li><a href="../deployment/maintenance_html.html">maintenance.html</a>
  
    <li><a href="../deployment/ubuntu-deployment-steps_txt.html">ubuntu-deployment-steps</a>
  
    <li><a href="../doc/README_FOR_APP.html">README_FOR_APP</a>
  
    <li><a href="../doc/bonnie_test_eMeasure_xml.html">bonnie_test_eMeasure.xml</a>
  
    <li><a href="../lib/assets/hqmf_template_oid_map_json.html">hqmf_template_oid_map.json</a>
  
    <li><a href="../lib/tasks/bonnie_rake.html">bonnie.rake</a>
  
    <li><a href="../lib/tasks/bonnie_run_once_rake.html">bonnie_run_once.rake</a>
  
    <li><a href="../lib/tasks/calculation_tests_rake.html">calculation_tests.rake</a>
  
    <li><a href="../lib/tasks/dashboard_rake.html">dashboard.rake</a>
  
    <li><a href="../lib/tasks/exporting/bundle_rake.html">bundle.rake</a>
  
    <li><a href="../lib/tasks/loading/bundle_rake.html">bundle.rake</a>
  
    <li><a href="../lib/tasks/loading/mat_rake.html">mat.rake</a>
  
    <li><a href="../lib/tasks/loading/sources_rake.html">sources.rake</a>
  
    <li><a href="../lib/tasks/loading/white_black_list_rake.html">white_black_list.rake</a>
  
    <li><a href="../lib/tasks/parser_comparison_rake.html">parser_comparison.rake</a>
  
    <li><a href="../lib/tasks/vsac_rake.html">vsac.rake</a>
  
    <li><a href="../public/favicon_ico.html">favicon.ico</a>
  
    <li><a href="../public/robots_txt.html">robots</a>
  
    <li><a href="../rdoc_help_txt.html">rdoc_help</a>
  
    <li><a href="../spec/javascripts/fixtures/json/README.html">README</a>
  
    <li><a href="../spec/javascripts/fixtures/json/measure_diff_json.html">measure_diff.json</a>
  
    <li><a href="../spec/javascripts/fixtures/json/measure_sets_json.html">measure_sets.json</a>
  
    <li><a href="../spec/javascripts/fixtures/json/measures_json.html">measures.json</a>
  
    <li><a href="../spec/javascripts/fixtures/json/patients_json.html">patients.json</a>
  
    <li><a href="../spec/javascripts/fixtures/json/value_sets_json.html">value_sets.json</a>
  
    <li><a href="../spec/javascripts/helpers/jasmine-jquery-2_1_0_js.html">jasmine-jquery-2.1.0.js</a>
  
    <li><a href="../spec/javascripts/helpers/waitsForAndRuns_js.html">waitsForAndRuns.js</a>
  
    <li><a href="../spec/javascripts/spec_js.html">spec.js</a>
  
    <li><a href="../test/fixtures/draft_measures/CMS104v2_json.html">CMS104v2.json</a>
  
    <li><a href="../test/fixtures/draft_measures/CMS138v2_json.html">CMS138v2.json</a>
  
    <li><a href="../test/fixtures/patient_builder/source_data_criteria_json.html">source_data_criteria.json</a>
  
    <li><a href="../test/fixtures/records/BH_Adult_A_json.html">BH_Adult_A.json</a>
  
    <li><a href="../test/fixtures/records/BH_Adult_B_json.html">BH_Adult_B.json</a>
  
    <li><a href="../test/fixtures/records/BH_Adult_C_json.html">BH_Adult_C.json</a>
  
    <li><a href="../test/fixtures/records/BH_Adult_D_json.html">BH_Adult_D.json</a>
  
    <li><a href="../test/fixtures/users/bonnie_json.html">bonnie.json</a>
  
    <li><a href="../test/fixtures/users/user_admin_json.html">user_admin.json</a>
  
    <li><a href="../test/fixtures/users/user_plain_json.html">user_plain.json</a>
  
    <li><a href="../test/fixtures/users/user_unapproved_json.html">user_unapproved.json</a>
  
    <li><a href="../testplan/435ComplexV2_v4_SimpleXML_xml.html">435ComplexV2_v4_SimpleXML.xml</a>
  
    <li><a href="../testplan/DischargedOnAntithrombotic_eMeasure_xml.html">DischargedOnAntithrombotic_eMeasure.xml</a>
  
    <li><a href="../testplan/testplan_txt.html">testplan</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page deployment/ubuntu-deployment-steps.txt">

<p>On Ubuntu 12.04 system:</p>
<hr>

<p>Update packages:</p>

<pre>sudo apt-get -y update</pre>

<p>Install apache:</p>

<pre>sudo apt-get install -y apache2</pre>

<p>Install some other dependencies:</p>

<pre>sudo apt-get install -y libcurl4-openssl-dev apache2-threaded-dev libapr1-dev libaprutil1-dev libgmp3-dev</pre>

<p>Install mongodb:</p>

<pre>sudo sh -c &quot;echo &#39;deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen&#39; &gt;&gt; /etc/apt/sources.list&quot;
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv 7F0CEB10
sudo apt-get update
sudo apt-get install mongodb-10gen</pre>

<p>Install RVM:</p>

<pre>curl -L https://get.rvm.io | sudo -i bash -s stable</pre>

<p>Log out and back in, then install ruby using rvm and some related
components</p>

<pre>sudo -i
rvm autolibs enable
rvm install 2.2.3
rvm --default 2.2.3
gem install bundler
gem install passenger
gem install capistrano -v 3.2.1
gem install capistrano-bundler -v 1.1.2
gem install capistrano-rails -v 1.1.1
gem install rvm1-capistrano3 -v 1.2.2
exit</pre>

<p>Install passenger apache 2 module (select ruby only)</p>

<pre>sudo -i
passenger-install-apache2-module
exit</pre>

<p>Add some needed apache modules</p>

<pre class="ruby"><span class="ruby-identifier">sudo</span> <span class="ruby-identifier">a2enmod</span> <span class="ruby-identifier">headers</span>
<span class="ruby-identifier">sudo</span> <span class="ruby-identifier">a2enmod</span> <span class="ruby-identifier">expires</span>
</pre>

<h6 id="label-FOR+APACHE+2.2+-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D">FOR APACHE 2.2 =============<span><a href="#label-FOR+APACHE+2.2+-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D">&para;</a> <a href="#top">&uarr;</a></span></h6>

<p>Add a file (as root, using sudo -i):</p>

<pre>/etc/apache2/conf.d/mod_passenger.conf</pre>

<p>With the following content (use output from
passenger-install-apache2-module):</p>

<pre>LoadModule passenger_module /usr/local/rvm/gems/ruby-2.0.0-p451/gems/passenger-4.0.37/buildout/apache2/mod_passenger.so
&lt;IfModule mod_passenger.c&gt;
  PassengerRoot /usr/local/rvm/gems/ruby-2.0.0-p451/gems/passenger-4.0.37
  PassengerDefaultRuby /usr/local/rvm/gems/ruby-2.0.0-p451/wrappers/ruby
  PassengerMinInstances 4
  PassengerMaxPoolSize 4
  PassengerMaxRequests 1000
  PassengerPreStart http://localhost/
&lt;/IfModule&gt;</pre>

<p>Add a file (as root, using sudo -i):</p>

<pre>/etc/apache2/sites-available/bonnie</pre>

<p>With the following content (changing the path appropriately):</p>

<pre>&lt;VirtualHost *:80&gt;
  DocumentRoot &lt;path&gt;/bonnie/current/public
  RewriteEngine On
  ErrorDocument 503 /system/maintenance.html
  RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f
  RewriteCond %{SCRIPT_FILENAME} !maintenance.html
  RewriteRule ^.*$ - [L,R=503]
  &lt;Location /assets/&gt;
    # Use of ETag is discouraged when Last-Modified is present
    Header unset ETag
    FileETag None
    # RFC says only cache for 1 year
    ExpiresActive On
    ExpiresDefault &quot;access plus 1 year&quot;
  &lt;/Location&gt;
  &lt;Directory &lt;path&gt;/bonnie/current/public&gt;
    AllowOverride all
    Options -MultiViews
    # Compress css and js
    AddOutputFilterByType DEFLATE text/css application/x-javascript application/javascript text/javascript
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;</pre>

<h6 id="label-FOR+APACHE+2.4+-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D">FOR APACHE 2.4 =============<span><a href="#label-FOR+APACHE+2.4+-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D">&para;</a> <a href="#top">&uarr;</a></span></h6>

<p>Add a file (as root, using sudo -i):</p>

<pre>/etc/apache2/conf-available/mod_passenger.conf</pre>

<p>With the following content (use output from
passenger-install-apache2-module):</p>

<pre>LoadModule passenger_module /usr/local/rvm/gems/ruby-2.0.0-p451/gems/passenger-4.0.37/buildout/apache2/mod_passenger.so
&lt;IfModule mod_passenger.c&gt;
  PassengerRoot /usr/local/rvm/gems/ruby-2.0.0-p451/gems/passenger-4.0.37
  PassengerDefaultRuby /usr/local/rvm/gems/ruby-2.0.0-p451/wrappers/ruby
  PassengerMinInstances 4
  PassengerMaxPoolSize 4
  PassengerMaxRequests 1000
  PassengerPreStart http://localhost/
&lt;/IfModule&gt;</pre>

<p>Then run</p>

<pre class="ruby"><span class="ruby-identifier">sudo</span> <span class="ruby-identifier">a2enconf</span> <span class="ruby-identifier">mod_passenger</span>
</pre>

<p>Add a file (as root, using sudo -i):</p>

<pre>/etc/apache2/sites-available/bonnie</pre>

<p>With the following content (changing the path appropriately):</p>

<pre>&lt;VirtualHost *:80&gt;
  DocumentRoot &lt;path&gt;/bonnie/current/public
  RewriteEngine On
  ErrorDocument 503 /system/maintenance.html
  RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f
  RewriteCond %{SCRIPT_FILENAME} !maintenance.html
  RewriteRule ^.*$ - [L,R=503]
  &lt;Location /assets/&gt;
    # Use of ETag is discouraged when Last-Modified is present
    Header unset ETag
    FileETag None
    # RFC says only cache for 1 year
    ExpiresActive On
    ExpiresDefault &quot;access plus 1 year&quot;
  &lt;/Location&gt;
  &lt;Directory &lt;path&gt;/bonnie/current/public&gt;
    AllowOverride all
    Options -MultiViews
    Require all granted
    # Compress css and js
    AddOutputFilterByType DEFLATE text/css application/x-javascript application/javascript text/javascript
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;</pre>

<h6 id="label-END+APACHE+2.4+-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D">END APACHE 2.4 =============<span><a href="#label-END+APACHE+2.4+-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D-3D">&para;</a> <a href="#top">&uarr;</a></span></h6>

<p>Configure sites:</p>

<pre class="ruby"><span class="ruby-identifier">sudo</span> <span class="ruby-identifier">a2dissite</span> <span class="ruby-identifier">default</span>
<span class="ruby-identifier">sudo</span> <span class="ruby-identifier">a2ensite</span> <span class="ruby-identifier">bonnie</span>
</pre>

<p>If necessary, create a deploy user account (if one already exists skip this
step)</p>

<pre>sudo adduser &lt;deployuser&gt;</pre>

<p>If Capistrano will be run from the deploy system (kicked off externally by
a deployment hook), create an ssh key for the deployment account and allow
the account to ssh to itself using that key</p>

<pre>sudo -u &lt;deployuser&gt; -i
ssh-keygen -f ~/.ssh/id_rsa -N &#39;&#39;
cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
ssh -oStrictHostKeyChecking=no localhost exit
exit</pre>

<p>Create some shared resources local to the deployment system</p>

<pre>shared/config/initializers/secret_token.rb (with unique local key created with &#39;rake secret&#39;)
shared/config/hostname (if host doesn&#39;t know it&#39;s own public name)</pre>

<p>Restart apache</p>

<pre class="ruby"><span class="ruby-identifier">sudo</span> <span class="ruby-identifier">service</span> <span class="ruby-identifier">apache2</span> <span class="ruby-identifier">reload</span>
</pre>

<p>If desired, configure monit to monitor services</p>

<pre>sudo apt-get install monit

edit /etc/monit/monitrc for 1 minute monitoring interval

  set daemon 60            # check services at 1-minute intervals

add a file: /etc/monit/conf.d/mongod

  check process mongodb with pidfile /var/lib/mongodb/mongod.lock
    start program = &quot;/usr/sbin/service mongodb start&quot;
    stop program = &quot;/usr/sbin/service mongodb stop&quot;
    if failed host 127.0.0.1 port 28017 protocol http
      and request &quot;/&quot; with timeout 10 seconds then restart
    if memory usage &gt; 70% for 5 cycles then restart
    if 5 restarts within 5 cycles then timeout

restart monit to include changes

  sudo service monit restart</pre>

<p>If desired, configure logrotate to rotate log files</p>

<pre>Create a file called /etc/logrotate.d/bonnie containing

  &lt;path&gt;/bonnie/current/log/production.log {
      monthly
      missingok
      notifempty
      rotate 36
      compress
      delaycompress
      copytruncate
      su &lt;user&gt; &lt;group&gt;
  }</pre>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

